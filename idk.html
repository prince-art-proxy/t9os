<script>
var win = window.open();
var url = "thetestbase99.html";   // same-origin page you control
var faviconUrl = "favicon.png";   // default fallback favicon

// Base shell for about:blank tab
win.document.write(`
<!DOCTYPE html>
<html>
<head>
  <title>T9 OS</title>
  <link rel="icon" type="image/x-icon" href="${faviconUrl}">
</head>
<body style="margin:0; padding:0; overflow:hidden;"></body>
</html>
`);
win.document.close();

// Add iframe
var iframe = win.document.createElement("iframe");
iframe.style.position = "fixed";
iframe.style.top = "0";
iframe.style.left = "0";
iframe.style.width = "100vw";
iframe.style.height = "100vh";
iframe.style.border = "none";
iframe.src = url;
win.document.body.appendChild(iframe);

// Grab reference to favicon in about:blank shell
var favicon = win.document.querySelector("link[rel='icon']");

// Function to sync title + favicon
function syncFromIframe(iframeDoc) {
  // Copy title
  win.document.title = iframeDoc.title || "T9 OS";

  // Copy favicon
  const iframeIcon = iframeDoc.querySelector("link[rel~='icon']");
  if (iframeIcon) {
    favicon.href = iframeIcon.href;
  } else {
    favicon.href = faviconUrl; // fallback
  }
}

// Watch for changes inside the iframe
iframe.addEventListener("load", () => {
  try {
    const iframeDoc = iframe.contentDocument;
    syncFromIframe(iframeDoc);

    // Use MutationObserver to auto-update when title or favicon changes
    const observer = new MutationObserver(() => {
      syncFromIframe(iframeDoc);
    });

    observer.observe(iframeDoc.head, {
      childList: true,
      subtree: true,
      attributes: true,
      attributeFilter: ["href", "rel"]
    });
  } catch (e) {
    console.warn("Cross-origin page, can't mirror title/favicon", e);
  }
});
</script>
